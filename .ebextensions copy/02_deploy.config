packages:
  yum:
    libjpeg-turbo-devel: []
    libpng-devel: []
    libcurl-devel: []
    libsndfile-devel: []
    postgresql: []

commands:
  01_yum_update:
    command: "sudo yum update -y"
  02_install_git:
    command: "sudo yum install -y git"
  03_install_build_tools:
    command: "sudo yum install -y gcc-c++ make"
  03_install_nodejs_repo:
    command: "sudo curl -sL https://rpm.nodesource.com/setup_10.x | bash -"
  04_install_nodejs:
    command: "sudo yum install -y nodejs"
  06_install_pg_devel:
    command: "sudo yum install -y postgresql"
  07_link_pg_config:
    command: "sudo ln -sf /usr/pgsql-9.6/bin/pg_config /usr/bin/"

container_commands:
  01_migrate:
      command: |
        source /var/app/venv/staging*/bin/activate
        python3 manage.py makemigrations
      leader_only: true
  02_migrate:
    command: "python manage.py migrate"
    leader_only: true
  03_populate_dummy: 
    command: "python manage.py populate_toy"
    leader_only: true
  04_npm_install:
    command: "npm install --production"
  05_staticone:
    command: "python manage.py collectstatic --noinput"
  06_compressor:
    command: "python manage.py compress --force"    

option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: microfaune_annotator.settings
  aws:elasticbeanstalk:container:python:
    WSGIPATH: microfaune_annotator/wsgi.py
  aws:ec2:vpc:
    VPCId: vpc-0b394b6676b7d50ea
    AssociatePublicIpAddress: 'false'
    ELBScheme: public
    ELBSubnets: subnet-0d5d002f6d1fbd06d,subnet-0eb0ad70069b6d265
    Subnets: subnet-068b7ee5c1d254e3b,subnet-0862c6bea72c893be